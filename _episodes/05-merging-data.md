---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 05-merging-data.md in _episodes_rmd/
title: "Merging and Joining Data"
keypoints:
- Use `merge()` to stack data
- Use `merge()` to join data
- Understand joins
objectives:
- Learn how to stack data frames (ex. different years' data)
- Learn how to join - inner, outer, etc.
- Explore after a join to verify results as expected
questions: How can I combine data from different sources?
source: Rmd
teaching: 45
exercises: 10
---



## Introduction goes here

Very often, studies record different types of data in different tables.  For example, there may be one table with demographic information about participants; there might be another table with lab measurements associated with the participants.

Discussion:

When might be some scenarios where it might be preferable not to record all of the study information in a single table?

For the next several lessons, we'll be working with a data set from the [Study of Women's Health Across the Nation (SWAN)](https://www.swanstudy.org/).  SWAN is a multi-site longitudinal, epidemiologic study.  The study, which began in 1994 and is still ongoing, examines the physical, biological, psychological, and social changes in women during their middle years.
```
Citation: 
Sutton-Tyrell, Kim, Selzer, Faith, Sowers, MaryFran R. (Mary Francis Roy), Finkelstein, Joel, Powell, Lynda, Gold, Ellen B., … Matthews, Karen. Study of Women’s Health Across the Nation (SWAN), 2002-2004: Visit 06 Dataset. Ann Arbor, MI: Inter-university Consortium for Political and Social Research [distributor], 2018-11-13. https://doi.org/10.3886/ICPSR31181.v2
```

The SWAN study collected data in 3-year cycles.  We'll be working with the 2002-2004 cycle data.  Although the study collected data on hundreds of variables across thousands of women, we'll focus our analysis on the following smaller set of variables:

Variable | Description
------------- | -------------
SWANID | Participant's Study Identifier
AGE6 | Age
RACE | Race at Screener
BMI6 | Body Mass Index (BMI)
LDLRESU6 | Low-density lipoprotein cholesterol (estimated) mg/dl
HDLRESU6 | High density lipoprotein cholesterol mg/dl
GLUCRES6 | Glucose mg/dl
CRPRESU6 | C-reactive protein mg/l
DIABP16 | Diastolic blood pressure mmHg
SYSBP16 | Systolic blood pressure mmHg
EXERCIS6 | During the past 12 months, have you exercised?
SMOKERE6 |  Since your last study visit, have you smoked cigarettes regularly (at least one cigarette a day)?
STATUS6 | Menopausal Status 



STATUS6 | Menopausal Status :
 1 = Post by BSO (Bilateral Salpingo Oophorectomy)
 2 = Natural Post
 3 = Late Peri
 4 = Early Peri
 5 = Pre
6 = Pregnant/breastfeeding
7 = Unknown due to HT use
8 = Unknown due to hysterectomy

RACE Race at Screener
1: Black/African American
2: Chinese/Chinese American
3: Japanese/Japanese American
4: Caucasian/ White Non-Hispanic
5: Hispanic



In our case, we have two tables, a demographic table and a table with lab measurements.

We'll start by reading each of them into a separate data frame.


~~~
swan_demographic <- read.csv('../data/SWAN_2002_2004/DS0001/swan_demo.csv')
swan_lab <- read.csv('../data/SWAN_2002_2004/DS0001/swan_lab.csv')
~~~
{: .language-r}

Let's take a peek at each data frame:

~~~
head(swan_demographic)
~~~
{: .language-r}



~~~
  SWANID VISIT INTDAY6 AGE6 LANGINT6 RACE
1  10046     6    2310   58        1    2
2  10056     6    2199   57        1    4
3  10126     6    2213   54        1    1
4  10153     6    2201   57        1    3
5  10196     6    2213   52        1    2
6  10245     6    2296   54        1    4
~~~
{: .output}

`swan_lab` is very wide, but feel free to peek at it using head() and/or by clicking on it in RStudio's Environment pane.  Notice that when there are many variables, RStudio provides buttons for paginating left and right through the variables.

Let's look at the variable names (column names):


~~~
colnames(swan_demographic)
~~~
{: .language-r}



~~~
[1] "SWANID"   "VISIT"    "INTDAY6"  "AGE6"     "LANGINT6" "RACE"    
~~~
{: .output}


~~~
colnames(swan_lab)
~~~
{: .language-r}



~~~
  [1] "SWANID"    "VISIT"     "PREGNAN6"  "PREVBLO6"  "EATDRIN6" 
  [6] "STRTPER6"  "BLEDAY6"   "BLDRWAT6"  "BLDDRAW6"  "SPEDAY6"  
 [11] "ANTICO16"  "ACOATW16"  "ANTICO26"  "ACOATW26"  "HEART16"  
 [16] "HARTTW16"  "HEART26"   "HARTTW26"  "CHOLST16"  "CHOLTW16" 
 [21] "CHOLST26"  "CHOLTW26"  "BP16"      "BPTW16"    "BP26"     
 [26] "BPTW26"    "DIURET16"  "DIURTW16"  "DIURET26"  "DIURTW26" 
 [31] "THYROI16"  "THYRTW16"  "THYROI26"  "THYRTW26"  "INSULN16" 
 [36] "INSUTW16"  "INSULN26"  "INSUTW26"  "NERVS16"   "NERVTW16" 
 [41] "NERVS26"   "NERVTW26"  "STEROI16"  "STERTW16"  "STEROI26" 
 [46] "STERTW26"  "FERTIL16"  "FRTLTW16"  "FERTIL26"  "FRTLTW26" 
 [51] "BCP16"     "BCPTWI16"  "BCP26"     "BCPTWI26"  "BCREAS6"  
 [56] "BCRES_S6"  "ESTROG16"  "ESTRTW16"  "ESTROG26"  "ESTRTW26" 
 [61] "ESTRDA16"  "ESTRDA26"  "ESTRNJ16"  "EINJTW16"  "ESTRNJ26" 
 [66] "EINJTW26"  "COMBIN16"  "COMBTW16"  "COMBIN26"  "COMBTW26" 
 [71] "PROGES16"  "PROGTW16"  "PROGES26"  "PROGTW26"  "PROGDA16" 
 [76] "PROGDA26"  "OSTEPR16"  "OSTETW16"  "OSTEPR26"  "OSTETW26" 
 [81] "ARTHRT16"  "ARTHTW16"  "ARTHRT26"  "ARTHTW26"  "OTHMED16" 
 [86] "OTHRTW16"  "OTHMED26"  "OTHRTW26"  "OTHMED36"  "OTHRTW36" 
 [91] "OTHMED46"  "OTHRTW46"  "OTHMED56"  "OTHRTW56"  "OTHMED66" 
 [96] "OTHRTW66"  "OTHMED76"  "OTHRTW76"  "OTHMED86"  "OTHRTW86" 
[101] "OTHMED96"  "OTHRTW96"  "OTHME106"  "OTHTW106"  "OTHME116" 
[106] "OTHTW116"  "OTHME126"  "OTHTW126"  "OTHME136"  "OTHTW136" 
[111] "OTHME146"  "OTHTW146"  "OTHME156"  "OTHTW156"  "ESTLSTV6" 
[116] "REDUHAR6"  "OSTEOPO6"  "MENOSYM6"  "YOUNGLK6"  "HCPADVI6" 
[121] "FRNADVI6"  "IMPRMEM6"  "REGPERI6"  "HORMOTH6"  "DONTKNO6" 
[126] "HORMDAY6"  "PRBBLEE6"  "HAVEPER6"  "LIKEFEL6"  "SIDEEFF6" 
[131] "CANCER6"   "ADVISTO6"  "EXPENSI6"  "NOLIKE6"   "NOREMEB6" 
[136] "DNTKNOW6"  "STOPOTH6"  "NOREASO6"  "REGVITA6"  "ONCEADA6" 
[141] "ANTIOXI6"  "VITCOMB6"  "VTMOTH16"  "VTMOTH26"  "VTMOTH36" 
[146] "VTMOTH46"  "VITAMNA6"  "BETACAR6"  "VITAMNC6"  "VITAMND6" 
[151] "VITAMNE6"  "CALCTUM6"  "IRON6"     "ZINC6"     "SELENIU6" 
[156] "VTMSING6"  "SVTMOT16"  "SVTMOT26"  "SVTMOT36"  "SVTMOT46" 
[161] "SVTMOT56"  "SVTMOT66"  "SVTMOT76"  "SVTMOT86"  "SVTMOT96" 
[166] "SVTMO106"  "PAIN16"    "PAINTW16"  "PAIN26"    "PAINTW26" 
[171] "SLEEP16"   "SLEPTW16"  "SLEEP26"   "SLEPTW26"  "OTC16"    
[176] "OTCTW16"   "OTC26"     "OTCTW26"   "OTC36"     "OTCTW36"  
[181] "OTC46"     "OTCTW46"   "ALCHL246"  "SOYYSNO6"  "SOYPROT6" 
[186] "CEREACA6"  "BREADCA6"  "ORANGCA6"  "ANEMIA6"   "DIABETE6" 
[191] "HIGHBP6"   "HBCHOLE6"  "MIGRAIN6"  "STROKE6"   "OSTEOAR6" 
[196] "THYROID6"  "HEARTAT6"  "ANGINA6"   "OSTEOPR6"  "CANCERS6" 
[201] "SITESPE6"  "TAMOXIF6"  "CHEMOTH6"  "BROKEBO6"  "BONES16"  
[206] "HAPPEN16"  "BONES26"   "HAPPEN26"  "BONES36"   "HAPPEN36" 
[211] "DANDC6"    "NUMDAND6"  "HYSTERE6"  "HYSTDAY6"  "OOPHORE6" 
[216] "ONEOVAR6"  "ABLATIN6"  "UTERPRO6"  "THYRREM6"  "ENDO6"    
[221] "ENDODIF6"  "PELVCPN6"  "DIFPELV6"  "PROLAPS6"  "DIFPROL6" 
[226] "PELVCNC6"  "DIFCANC6"  "ABBLEED6"  "DIFBLED6"  "FIBRUTR6" 
[231] "DIFFIBR6"  "PRVIDER6"  "PROFDEG6"  "SPECIFY6"  "PROVSPC6" 
[236] "SPECIAL6"  "PROVTIM6"  "BLEEDNG6"  "BLD3MON6"  "LMPDAY6"  
[241] "DESCPER6"  "LENGCYL6"  "PRGNANT6"  "OUTCOME6"  "BRSTFEE6" 
[246] "QLTYLIF6"  "LISTEN6"   "TAKETOM6"  "CONFIDE6"  "HELPSIC6" 
[251] "CONTROL6"  "ABILITY6"  "YOURWAY6"  "PILING6"   "BOTHER6"  
[256] "APPETIT6"  "BLUES6"    "GOOD6"     "KEEPMIN6"  "DEPRESS6" 
[261] "EFFORT6"   "HOPEFUL6"  "FAILURE6"  "FEARFUL6"  "RESTLES6" 
[266] "HAPPY6"    "TALKLES6"  "LONELY6"   "UNFRNDL6"  "ENJOY6"   
[271] "CRYING6"   "SAD6"      "DISLIKE6"  "GETGOIN6"  "SEPEXP6"  
[276] "SEPTHR6"   "SEPINJ6"   "SEPFAM6"   "SEPLEV6"   "SEPSAF6"  
[281] "SEPCON6"   "SEPEAC6"   "SEPFUT6"   "SEPGOV6"   "SEPCNF6"  
[286] "SEPANX6"   "CHNGJOB6"  "JOB6"      "CHANGHR6"  "STRTIM16" 
[291] "STPTIM16"  "ROTAT16"   "STRTIM26"  "STPTIM26"  "ROTAT26"  
[296] "STRTIM36"  "STPTIM36"  "ROTAT36"   "HOURSPA6"  "VOLUNTE6" 
[301] "VLNTHR16"  "VLNTHR26"  "VLNTHR36"  "MARITAL6"  "CHGHHLD6" 
[306] "HOUSEHL6"  "RELAT16"   "SEX16"     "AGE16"     "RELAT26"  
[311] "SEX26"     "AGE26"     "RELAT36"   "SEX36"     "AGE36"    
[316] "RELAT46"   "SEX46"     "AGE46"     "RELAT56"   "SEX56"    
[321] "AGE56"     "RELAT66"   "SEX66"     "AGE66"     "RELAT76"  
[326] "SEX76"     "AGE76"     "RELAT86"   "SEX86"     "AGE86"    
[331] "RELAT96"   "SEX96"     "AGE96"     "RELAT106"  "SEX106"   
[336] "AGE106"    "RELAT116"  "SEX116"    "AGE116"    "RELAT126" 
[341] "SEX126"    "AGE126"    "FIBROID6"  "FORMINT6"  "STATUS6"  
[346] "SAADAY6"   "FORMSAA6"  "LANGSAA6"  "OVERHLT6"  "HOSPSTA6" 
[351] "MDTALK6"   "NERVES6"   "PAPSMEA6"  "BRSTEXA6"  "MAMOGRA6" 
[356] "MEDICDY6"  "INSURDR6"  "INSDRCO6"  "INSURRX6"  "INSRXCO6" 
[361] "INSURHO6"  "INSHOCO6"  "HLTHSER6"  "INSURAN6"  "NOTAFFR6" 
[366] "NOTRANS6"  "NOPROVI6"  "TOOBUSY6"  "NOTRUST6"  "BETTROF6" 
[371] "FAILOTH6"  "SMOKERE6"  "AVCIGDA6"  "DRNKBEE6"  "GLASBEE6" 
[376] "GLASWIN6"  "GLASLIQ6"  "HLTHAYR6"  "V_ACTI6"   "M_ACTI6"  
[381] "LIFTING6"  "CLIMBS6"   "CLIMB1_6"  "BENDING6"  "WALKM6"   
[386] "WALKS6"    "WALK1_6"   "BATHING6"  "PHYCTDW6"  "PHYACCO6" 
[391] "PHYLIMI6"  "PHYDFCL6"  "EMOCTDW6"  "EMOACCO6"  "EMOCARE6" 
[396] "INTERFR6"  "BODYPAI6"  "PAINTRF6"  "PEP6"      "NERV4WK6" 
[401] "CHER4WK6"  "CALM4WK6"  "ENERGY6"   "BLUE4WK6"  "WORNOUT6" 
[406] "HAPY4WK6"  "TIRED6"    "SOCIAL6"   "HEALSIC6"  "HEALTHY6" 
[411] "HEALWOR6"  "HEALEXC6"  "CARING6"   "MEALS6"    "ROUTNCH6" 
[416] "MODERAT6"  "VIGOROU6"  "PHYSACT6"  "WATCHTV6"  "WALKBIK6" 
[421] "SWEATPA6"  "SPORTS6"   "SPOREX16"  "RATEIN16"  "MTHSAC16" 
[426] "HRSACT16"  "OTHSPOR6"  "SPOREX26"  "RATEIN26"  "MTHSAC26" 
[431] "HRSACT26"  "PHYSWOR6"  "WORKTIR6"  "WRKACTA6"  "WRKACTB6" 
[436] "WRKACTC6"  "WRKACTD6"  "WRKACTE6"  "WRKACTF6"  "WRKACTG6" 
[441] "STIFF6"    "ACHES6"    "COLDSWE6"  "NITESWE6"  "VAGINDR6" 
[446] "FEELBLU6"  "DIZZY6"    "IRRITAB6"  "NRVOUS6"   "FORGET6"  
[451] "MOODCHG6"  "HARTRAC6"  "FEARFULA6" "HDACHE6"   "HOTFLAS6" 
[456] "BRSTPAI6"  "TRBLSLE6"  "WAKEUP6"   "WAKEARL6"  "SLEEPQL6" 
[461] "GETUPUR6"  "INVOLEA6"  "DAYSLEA6"  "COUGHLE6"  "URGEVOI6" 
[466] "OTHRLEA6"  "NUTRIRE6"  "HERBREM6"  "PSYCMET6"  "PHYSMET6" 
[471] "FOLKMED6"  "OTHRTHE6"  "SPECOTH6"  "STARTNE6"  "WORKTRB6" 
[476] "QUITJOB6"  "WORKLOA6"  "PRTUNEM6"  "MONEYPR6"  "WORSREL6" 
[481] "RELATEN6"  "SERIPRO6"  "CHILDMO6"  "RESPCAR6"  "LEGALPR6" 
[486] "CRELDIE6"  "CLOSDIE6"  "SELFVIO6"  "FAMLVIO6"  "PHYSILL6" 
[491] "MAJEVEN6"  "EMPLYPA6"  "REWRDJO6"  "STRSSJO6"  "CRNTCAR6" 
[496] "RWRDCAR6"  "STRSCAR6"  "CRNTMAR6"  "RWRDREL6"  "STRSREL6" 
[501] "CHILDRE6"  "REWRDMO6"  "STRSSMO6"  "INCOME6"   "HOW_HAR6" 
[506] "LOSSINC6"  "FINAN1Y6"  "FINAN2Y6"  "FINAN3Y6"  "HOMEOWN6" 
[511] "HOMESPE6"  "LADERCO6"  "LADERUS6"  "INTRPAN6"  "DISIPAN6" 
[516] "EXCIPAN6"  "UPSEPAN6"  "STROPAN6"  "GUILPAN6"  "SCARPAN6" 
[521] "HOSTPAN6"  "ENTHPAN6"  "PROUPAN6"  "IRRIPAN6"  "ALERPAN6" 
[526] "ASHAPAN6"  "INSPPAN6"  "NERVPAN6"  "DETEPAN6"  "ATTEPAN6" 
[531] "JITTPAN6"  "ACTIPAN6"  "AFRAPAN6"  "STRENEX6"  "MODEREX6" 
[536] "ACUPUNC6"  "ACUPHAR6"  "ACUPOST6"  "ACUPMEN6"  "ACUPLOO6" 
[541] "ACUPMEM6"  "ACUPPER6"  "ACUPGEN6"  "ACUPWGH6"  "ACUPADV6" 
[546] "ACUPOTH6"  "ACUPSPE6"  "BCOHOSH6"  "BCOHHAR6"  "BCOHOST6" 
[551] "BCOHMEN6"  "BCOHLOO6"  "BCOHMEM6"  "BCOHPER6"  "BCOHGEN6" 
[556] "BCOHWGH6"  "BCOHADV6"  "BCOHOTH6"  "BCOHSPE6"  "DHEA6"    
[561] "DHEAHAR6"  "DHEAOST6"  "DHEAMEN6"  "DHEALOO6"  "DHEAMEM6" 
[566] "DHEAPER6"  "DHEAGEN6"  "DHEAWGH6"  "DHEAADV6"  "DHEAOTH6" 
[571] "DHEASPE6"  "DQUAI6"    "DQUAHAR6"  "DQUAOST6"  "DQUAMEN6" 
[576] "DQUALOO6"  "DQUAMEM6"  "DQUAPER6"  "DQUAGEN6"  "DQUAWGH6" 
[581] "DQUAADV6"  "DQUAOTH6"  "DQUASPE6"  "DIETNUT6"  "DIETHAR6" 
[586] "DIETOST6"  "DIETMEN6"  "DIETLOO6"  "DIETMEM6"  "DIETPER6" 
[591] "DIETGEN6"  "DIETWGH6"  "DIETADV6"  "DIETOTH6"  "DIETSPE6" 
[596] "HEALENR6"  "HEALHAR6"  "HEALOST6"  "HEALMEN6"  "HEALLOO6" 
[601] "HEALMEM6"  "HEALPER6"  "HEALGEN6"  "HEALWGH6"  "HEALADV6" 
[606] "HEALOTH6"  "HEALSPE6"  "EXERCIS6"  "EXERHAR6"  "EXEROST6" 
[611] "EXERMEN6"  "EXERLOO6"  "EXERMEM6"  "EXERPER6"  "EXERGEN6" 
[616] "EXERWGH6"  "EXERADV6"  "EXEROTH6"  "EXERSPE6"  "FLAXSEE6" 
[621] "FLAXHAR6"  "FLAXOST6"  "FLAXMEN6"  "FLAXLOO6"  "FLAXMEM6" 
[626] "FLAXPER6"  "FLAXGEN6"  "FLAXWGH6"  "FLAXADV6"  "FLAXOTH6" 
[631] "FLAXSPE6"  "GINKGO6"   "GINKHAR6"  "GINKOST6"  "GINKMEN6" 
[636] "GINKLOO6"  "GINKMEM6"  "GINKPER6"  "GINKGEN6"  "GINKWGH6" 
[641] "GINKADV6"  "GINKOTH6"  "GINKSPE6"  "GINSENG6"  "GINSHAR6" 
[646] "GINSOST6"  "GINSMEN6"  "GINSLOO6"  "GINSMEM6"  "GINSPER6" 
[651] "GINSGEN6"  "GINSWGH6"  "GINSADV6"  "GINSOTH6"  "GINSSPE6" 
[656] "GLUSAMI6"  "GLUSHAR6"  "GLUSOST6"  "GLUSMEN6"  "GLUSLOO6" 
[661] "GLUSMEM6"  "GLUSPER6"  "GLUSGEN6"  "GLUSWGH6"  "GLUSADV6" 
[666] "GLUSOTH6"  "GLUSSPE6"  "MYAMPRO6"  "MYAMHAR6"  "MYAMOST6" 
[671] "MYAMMEN6"  "MYAMLOO6"  "MYAMMEM6"  "MYAMPER6"  "MYAMGEN6" 
[676] "MYAMWGH6"  "MYAMADV6"  "MYAMOTH6"  "MYAMSPE6"  "MSM6"     
[681] "MSMHAR6"   "MSMOST6"   "MSMMEN6"   "MSMLOO6"   "MSMMEM6"  
[686] "MSMPER6"   "MSMGEN6"   "MSMWGH6"   "MSMADV6"   "MSMOTH6"  
[691] "MSMSPE6"   "PRAYER6"   "PRAYHAR6"  "PRAYOST6"  "PRAYMEN6" 
[696] "PRAYLOO6"  "PRAYMEM6"  "PRAYPER6"  "PRAYGEN6"  "PRAYWGH6" 
[701] "PRAYADV6"  "PRAYOTH6"  "PRAYSPE6"  "SAME6"     "SAMEHAR6" 
[706] "SAMEOST6"  "SAMEMEN6"  "SAMELOO6"  "SAMEMEM6"  "SAMEPER6" 
[711] "SAMEGEN6"  "SAMEWGH6"  "SAMEADV6"  "SAMEOTH6"  "SAMESPE6" 
[716] "SELFHEL6"  "SELFHAR6"  "SELFOST6"  "SELFMEN6"  "SELFLOO6" 
[721] "SELFMEM6"  "SELFPER6"  "SELFGEN6"  "SELFWGH6"  "SELFADV6" 
[726] "SELFOTH6"  "SELFSPE6"  "SOYSUPP6"  "SOYHAR6"   "SOYOST6"  
[731] "SOYMEN6"   "SOYLOO6"   "SOYMEM6"   "SOYPER6"   "SOYGEN6"  
[736] "SOYWGH6"   "SOYADV6"   "SOYOTH6"   "SOYSPE6"   "WORTSTJ6" 
[741] "WORTHAR6"  "WORTOST6"  "WORTMEN6"  "WORTLOO6"  "WORTMEM6" 
[746] "WORTPER6"  "WORTGEN6"  "WORTWGH6"  "WORTADV6"  "WORTOTH6" 
[751] "WORTSPE6"  "TAICHI6"   "TAIHAR6"   "TAIOST6"   "TAIMEN6"  
[756] "TAILOO6"   "TAIMEM6"   "TAIPER6"   "TAIGEN6"   "TAIWGH6"  
[761] "TAIADV6"   "TAIOTH6"   "TAISPE6"   "WVITAMI6"  "WVITHAR6" 
[766] "WVITOST6"  "WVITMEN6"  "WVITLOO6"  "WVITMEM6"  "WVITPER6" 
[771] "WVITGEN6"  "WVITWGH6"  "WVITADV6"  "WVITOTH6"  "WVITSPE6" 
[776] "YOGA6"     "YOGAHAR6"  "YOGAOST6"  "YOGAMEN6"  "YOGALOO6" 
[781] "YOGAMEM6"  "YOGAPER6"  "YOGAGEN6"  "YOGAWGH6"  "YOGAADV6" 
[786] "YOGAOTH6"  "YOGASPE6"  "OTHALT6"   "OTHALTS6"  "OTHHAR6"  
[791] "OTHOST6"   "OTHMEN6"   "OTHLOO6"   "OTHMEM6"   "OTHPER6"  
[796] "OTHGEN6"   "OTHWGH6"   "OTHADV6"   "OTHALTR6"  "WHYOTHA6" 
[801] "FLGSAAV6"  "SABDAY6"   "LANGSAB6"  "IMPORSE6"  "DESIRSE6" 
[806] "ENGAGSE6"  "NOPARTN6"  "PARTPRO6"  "PHYSPRO6"  "NOSEXOT6" 
[811] "SATISFY6"  "KISSING6"  "TOUCHIN6"  "ORALSEX6"  "INTCOUR6" 
[816] "AROUSED6"  "PELVIC6"   "LUBRICN6"  "ABLECLM6"  "IMPCLMX6" 
[821] "SATISFD6"  "FREQUEN6"  "MEN6MOS6"  "MASTURB6"  "FLGSABV6" 
[826] "PHYDAY6"   "PULSE6"    "SYSBP16"   "DIABP16"   "SYSBP26"  
[831] "DIABP26"   "HEIGHT6"   "HTMETHO6"  "WEIGHT6"   "SCALE6"   
[836] "WAIST6"    "WASTMEA6"  "HIP6"      "HIPMEAS6"  "FLGPHYV6" 
[841] "BMI6"      "COGDAY6"   "LANGCOG6"  "IMEDTHR6"  "IMEDCH16" 
[846] "IMEDHOU6"  "IMEDFIR6"  "IMEDFMN6"  "IMEDCLM6"  "IMEDCH26" 
[851] "IMEDRES6"  "IMEDMIN6"  "IMEDINJ6"  "IMEDEVR6"  "IMEDWEL6" 
[856] "TOTIDE16"  "SDMTSTA6"  "SDMTADM6"  "SDMTPRA6"  "SDMTATM6" 
[861] "SDMTCOR6"  "DIGIT1A6"  "DIGIT1B6"  "DIGIT2A6"  "DIGIT2B6" 
[866] "DIGIT3A6"  "DIGIT3B6"  "DIGIT4A6"  "DIGIT4B6"  "DIGIT5A6" 
[871] "DIGIT5B6"  "DIGIT6A6"  "DIGIT6B6"  "DIGTOT6"   "DLAYTHR6" 
[876] "DLAYCH16"  "DLAYHOU6"  "DLAYFIR6"  "DLAYFMN6"  "DLAYCLM6" 
[881] "DLAYCH26"  "DLAYRES6"  "DLAYMIN6"  "DLAYINJ6"  "DLAYEVR6" 
[886] "DLAYWEL6"  "TOTIDE26"  "FLGCOGV6"  "HRMDAY6"   "CYCDAY6"  
[891] "DHAS6"     "FSH6"      "SHBG6"     "T6"        "E2AVE6"   
[896] "FLGCV6"    "FLGDIF6"   "CVRDAY6"   "FLAGSER6"  "CHOLRES6" 
[901] "TRIGRES6"  "LDLRESU6"  "HDLRESU6"  "GLUCRES6"  "INSURES6" 
[906] "PAIRESU6"  "TPARESU6"  "LPARESU6"  "APOARES6"  "APOBRES6" 
[911] "CRPRESU6"  "SPSCDAY6"  "SPSCTIM6"  "SPSCMOD6"  "HPSCDAY6" 
[916] "HPSCTIM6"  "HPSCMOD6"  "SPBMDT6"   "HPBMDT6"   "BMDFLG6"  
[921] "BIODAY6"   "LANGBIO6"  "AICDPUM6"  "EXER12H6"  "EAT5HR6"  
[926] "ALCO24H6"  "METJEWL6"  "COMPBIA6"  "SIDE6"     "CONDRAW6" 
[931] "CONDFRZ6"  "IMPERAW6"  "IMPEFRZ6"  "PBFBIA6"   "SKELMM6"  
[936] "TBWNHAN6"  "FFMNHAN6"  "TBFNHAN6"  "PBFNHAN6"  "MISSCON6" 
[941] "MISSPHY6"  "FLAGSRP6"  "FLGBIOV6"  "CAMDAY6"  
~~~
{: .output}

What we'd ultimately like is to match up the observations in the lab table with the demographic data, only keeping columns of potential interest.

* From swan_demographic we would like to use STUDYID, AGE6, RACE.
* From swan_lab we would like to use LDLRESU6, BMI6, GLUCRES6, CRPRESU6, DIABP16, SYSBP16, EXERCIS6, SMOKERE6

We'll use the `merge()` function to join the data frames together.  The function's parameters refer to the "left" data frame as "x", and the "right" data frame as "y".

The `merge()` function allows us to make a number of choices:

* We can specify which variable is the one to match by.  In many cases, the variable may have one name in one table, and a different name in the other table, so `by.x` and `by.y` could be different.  You can even specify multiple columns to match on (you would set `by.x` and `by.y` to vectors of variable names).
* We can specify whether to keep rows from the "x" table which do not match up with any rows in the "y" table, and whether to keep rows from the "y" table which do not match up with any rows in the "x" table, using the `all.x` and `all.y` parameters.


~~~
swan_df <- merge(x = swan_demographic, y = swan_lab, by.x="SWANID", by.y="SWANID",
                   all.x=FALSE, all.y=TRUE)
~~~
{: .language-r}


HERE WE NEED TO CONSIDER DPLYR FOR JOINING. #TODO

It might be a good idea to write out an intermediate data file with what we have so far, because this is the data we'll be working with from this point forward.  In a common format like CSV, you might wish to share the file with others at this point.

#TODO: Say why we have to use row.names=FALSE


~~~
write.csv(swan_df, file = 'data_out/swan_merge.csv', row.names = FALSE)
~~~
{: .language-r}

## STOP HERE BUT SAVE THE STUFF BELOW

Variables of interest:
BMI, BP, LDL, TC, HDL, GLU, AGE,
-We are interested in the association between TC and BMI categories. (Total chol (TC) = outcome and glucose (main predictor))

1. After merging, first look at NAs and summaries of variables.

~~~
# Look at descriptive statistics of all independent variables

summary(merge_df$LBXTC) # total chol --> outcome variable.
~~~
{: .language-r}



~~~
Error in summary(merge_df$LBXTC): object 'merge_df' not found
~~~
{: .error}



~~~
sd(merge_df$LBXTC, na.rm = TRUE) # gives standard deviation; removes na values (na.rm=TRUE)
~~~
{: .language-r}



~~~
Error in is.data.frame(x): object 'merge_df' not found
~~~
{: .error}



~~~
summary(merge_df$LBXGLU) # glucose
~~~
{: .language-r}



~~~
Error in summary(merge_df$LBXGLU): object 'merge_df' not found
~~~
{: .error}



~~~
summary(merge_df$BMXBMI) # BMI
~~~
{: .language-r}



~~~
Error in summary(merge_df$BMXBMI): object 'merge_df' not found
~~~
{: .error}



~~~
summary(merge_df$RIDAGEYR) #TODO exclude people <18yo now. 
~~~
{: .language-r}



~~~
Error in summary(merge_df$RIDAGEYR): object 'merge_df' not found
~~~
{: .error}

2. Next, let's look at these variables in detail with graphs:

~~~
hist(merge_df$LBXTC, breaks = 30, xlab = "Total cholesterol (TC) (mg/dl)",  main = "Distribution of Total Cholesterol") # looks normal overall
~~~
{: .language-r}



~~~
Error in hist(merge_df$LBXTC, breaks = 30, xlab = "Total cholesterol (TC) (mg/dl)", : object 'merge_df' not found
~~~
{: .error}



~~~
hist(merge_df$LBXGLU, breaks = 100) # right skewed
~~~
{: .language-r}



~~~
Error in hist(merge_df$LBXGLU, breaks = 100): object 'merge_df' not found
~~~
{: .error}



~~~
boxplot(merge_df$LBXGLU) # looking at outliers of IV
~~~
{: .language-r}



~~~
Error in boxplot(merge_df$LBXGLU): object 'merge_df' not found
~~~
{: .error}



~~~
hist(merge_df$BMXBMI, breaks = 50) # slightly right skewed
~~~
{: .language-r}



~~~
Error in hist(merge_df$BMXBMI, breaks = 50): object 'merge_df' not found
~~~
{: .error}



~~~
boxplot(merge_df$BMXBMI) # looking at outliers of IV
~~~
{: .language-r}



~~~
Error in boxplot(merge_df$BMXBMI): object 'merge_df' not found
~~~
{: .error}



~~~
hist(merge_df$RIDAGEYR, breaks = 50) # if you ignore >=80 category and <=10, it's normal looking. 
~~~
{: .language-r}



~~~
Error in hist(merge_df$RIDAGEYR, breaks = 50): object 'merge_df' not found
~~~
{: .error}



~~~
#TODO Create histograms etc of Blood pressure variables here (for continuous)
~~~
{: .language-r}

3. Let's drop anyone under the age of 25 b/c changes in TC may not be apparent in the younger age groups. 

~~~
merge25_df <- merge_df %>% filter((RIDAGEYR>=25 & RIDAGEYR<80)) #& LBXGLU<=200)
~~~
{: .language-r}



~~~
Error in merge_df %>% filter((RIDAGEYR >= 25 & RIDAGEYR < 80)): could not find function "%>%"
~~~
{: .error}



~~~
boxplot(merge25_df$LBXGLU) # looking at outliers again in this new dataset
~~~
{: .language-r}



~~~
Error in boxplot(merge25_df$LBXGLU): object 'merge25_df' not found
~~~
{: .error}



~~~
boxplot(merge25_df$BMXBMI) # looking at outliers again
~~~
{: .language-r}



~~~
Error in boxplot(merge25_df$BMXBMI): object 'merge25_df' not found
~~~
{: .error}

4.Let's do scatter plots to see linear relationship between predictors and outcome variable:

~~~
scatter.smooth(merge25_df$LBXGLU, merge25_df$LBXTC, xlab = "Glucose levels (mg/dl)", ylab = "Total Cholesterol (mg/dl)")
~~~
{: .language-r}



~~~
Error in xy.coords(x, y, xlabel, ylabel): object 'merge25_df' not found
~~~
{: .error}



~~~
scatter.smooth(merge25_df$BMXBMI, merge25_df$LBXTC, xlab = "BMI", ylab = "Total Cholesterol (mg/dl)")
~~~
{: .language-r}



~~~
Error in xy.coords(x, y, xlabel, ylabel): object 'merge25_df' not found
~~~
{: .error}



~~~
scatter.smooth(merge25_df$RIDAGEYR, merge25_df$LBXTC, xlab = "Age (years)", ylab = "Total Cholesterol (mg/dl)")
~~~
{: .language-r}



~~~
Error in xy.coords(x, y, xlabel, ylabel): object 'merge25_df' not found
~~~
{: .error}



~~~
scatter.smooth(merge25_df$LBDHDD, merge25_df$LBXTC, xlab = "HDL", ylab = "Total Cholesterol (mg/dl)")
~~~
{: .language-r}



~~~
Error in xy.coords(x, y, xlabel, ylabel): object 'merge25_df' not found
~~~
{: .error}



~~~
scatter.smooth(merge25_df$LBDLDL, merge25_df$LBXTC, xlab = "LDL", ylab = "Total Cholesterol (mg/dl)")
~~~
{: .language-r}



~~~
Error in xy.coords(x, y, xlabel, ylabel): object 'merge25_df' not found
~~~
{: .error}

5. Let's do a correlation matrix now

~~~
cor(merge25_df[ , c("LBXGLU", "BMXBMI", "RIDAGEYR", "LBDHDD", "LBDLDL")], use = "complete.obs") # everything looks like below 27% multicollinearity.
~~~
{: .language-r}



~~~
Error in is.data.frame(x): object 'merge25_df' not found
~~~
{: .error}

BLOOD PRESSURE CATEGORIES:
https://www.heart.org/-/media/data-import/downloadables/pe-abh-what-is-high-blood-pressure-ucm_300310.pdf

6. Let's create catgegories for variables we are intersted in.

~~~
bp_cat <- function(sbp, dbp) {
 if (is.na(sbp) | is.na(dbp)){
   return(NA)
 }
  #if (sbp>=180 | dbp >=120) {
   # return("Hypertensive Crisis")
  #}
if (sbp>=140 | dbp >=90) {
    return("Hypertension Stage 2+")
  }

if ((sbp>=130 & sbp<=139) | (dbp >=80 & dbp <=89)) {
    return("Hypertension Stage 1")
  }

 if ((sbp>=120 & sbp<=129) &  dbp <80) {
    return("Elevated")
  }

  if (sbp < 120 & dbp <80) {
    return("Normal") 
  }
} 
~~~
{: .language-r}



~~~
# Converting Blood pressure into categories
# merge25_df <- merge25_df %>% mutate(bp_category = bp_cat(BPXSY1, BPXDI1))
merge25_df$bp_category <- mapply(bp_cat, merge25_df$BPXSY1, merge25_df$BPXDI1)
~~~
{: .language-r}



~~~
Error in mapply(bp_cat, merge25_df$BPXSY1, merge25_df$BPXDI1): object 'merge25_df' not found
~~~
{: .error}

Let's first make sure that everything looks okay.  There are over 50 variables, so scrolling through the data frame in the viewer is not a great option.


~~~
# See what the range of text vales is
unique(merge25_df$bp_category)
~~~
{: .language-r}



~~~
Error in unique(merge25_df$bp_category): object 'merge25_df' not found
~~~
{: .error}



~~~
# Look at just the pertinent columns
just_bp <- merge25_df %>% select(BPXSY1, BPXDI1, bp_category) # check to make sure no NULL values and categories are correctly created
~~~
{: .language-r}



~~~
Error in merge25_df %>% select(BPXSY1, BPXDI1, bp_category): could not find function "%>%"
~~~
{: .error}


~~~
# Converting to factor 
merge25_df$bp_category <- as.factor(merge25_df$bp_category) 
~~~
{: .language-r}



~~~
Error in is.factor(x): object 'merge25_df' not found
~~~
{: .error}



~~~
merge25_df$bp_category <- relevel(merge25_df$bp_category, "Normal") #sets "normal" as reference.
~~~
{: .language-r}



~~~
Error in relevel(merge25_df$bp_category, "Normal"): object 'merge25_df' not found
~~~
{: .error}



~~~
str(merge25_df$bp_category)  # Observe that it's a factor
~~~
{: .language-r}



~~~
Error in str(merge25_df$bp_category): object 'merge25_df' not found
~~~
{: .error}



~~~
table(merge25_df$bp_category, useNA = "ifany")  # Inspect the values
~~~
{: .language-r}



~~~
Error in table(merge25_df$bp_category, useNA = "ifany"): object 'merge25_df' not found
~~~
{: .error}



~~~
barplot(table(merge25_df$bp_category)) #TODO reorder so it looks ordinal
~~~
{: .language-r}



~~~
Error in table(merge25_df$bp_category): object 'merge25_df' not found
~~~
{: .error}


~~~
# Convert BMI into categories
merge25_df$BMI_category <- cut(merge25_df$BMXBMI, breaks = c(0, 18.5, 25.0, 30.0, 35.0, 40, 100), labels = c("Underweight", "Normal", "Pre-obese", "Obesity I", "Obesity II", "Obesity III"), right = FALSE)
~~~
{: .language-r}



~~~
Error in cut(merge25_df$BMXBMI, breaks = c(0, 18.5, 25, 30, 35, 40, 100), : object 'merge25_df' not found
~~~
{: .error}



~~~
merge25_df$BMI_category <- relevel(merge25_df$BMI_category, "Normal") #this sets "normal" as the reference category.
~~~
{: .language-r}



~~~
Error in relevel(merge25_df$BMI_category, "Normal"): object 'merge25_df' not found
~~~
{: .error}



~~~
summary(merge25_df$BMI_category)
~~~
{: .language-r}



~~~
Error in summary(merge25_df$BMI_category): object 'merge25_df' not found
~~~
{: .error}

NOTE: lm ignoes NAs (check this again though).  Make a note of this in the write up of the lesson. 

7. Simple linear regression models:

~~~
#TODO: Set appropriate reference levels in factor variables (for BP and BMI)

# glucose
lm_gluc <- lm(LBXTC ~ LBXGLU, data = merge25_df) 
~~~
{: .language-r}



~~~
Error in is.data.frame(data): object 'merge25_df' not found
~~~
{: .error}



~~~
summary(lm_gluc)
~~~
{: .language-r}



~~~
Error in summary(lm_gluc): object 'lm_gluc' not found
~~~
{: .error}



~~~
# bmi
lm_bmi <- lm(LBXTC ~ BMXBMI, data = merge25_df)
~~~
{: .language-r}



~~~
Error in is.data.frame(data): object 'merge25_df' not found
~~~
{: .error}



~~~
summary(lm_bmi)
~~~
{: .language-r}



~~~
Error in summary(lm_bmi): object 'lm_bmi' not found
~~~
{: .error}



~~~
# bmi categorical
lm_bmicat <- lm(LBXTC ~ BMI_category, data = merge25_df)
~~~
{: .language-r}



~~~
Error in is.data.frame(data): object 'merge25_df' not found
~~~
{: .error}



~~~
summary(lm_bmicat)
~~~
{: .language-r}



~~~
Error in summary(lm_bmicat): object 'lm_bmicat' not found
~~~
{: .error}



~~~
# age
lm_age <- lm(LBXTC ~ RIDAGEYR, data = merge25_df)
~~~
{: .language-r}



~~~
Error in is.data.frame(data): object 'merge25_df' not found
~~~
{: .error}



~~~
summary(lm_age)
~~~
{: .language-r}



~~~
Error in summary(lm_age): object 'lm_age' not found
~~~
{: .error}



~~~
# hdl
lm_hdl <- lm(LBXTC ~ LBDHDD, data = merge25_df)
~~~
{: .language-r}



~~~
Error in is.data.frame(data): object 'merge25_df' not found
~~~
{: .error}



~~~
summary(lm_hdl)
~~~
{: .language-r}



~~~
Error in summary(lm_hdl): object 'lm_hdl' not found
~~~
{: .error}



~~~
# ldl
lm_ldl <- lm(LBXTC ~ LBDLDL, data = merge25_df)
~~~
{: .language-r}



~~~
Error in is.data.frame(data): object 'merge25_df' not found
~~~
{: .error}



~~~
summary(lm_ldl)
~~~
{: .language-r}



~~~
Error in summary(lm_ldl): object 'lm_ldl' not found
~~~
{: .error}



~~~
# BP categorical
lm_bp <- lm(LBXTC ~ bp_category, data = merge25_df)
~~~
{: .language-r}



~~~
Error in is.data.frame(data): object 'merge25_df' not found
~~~
{: .error}



~~~
summary(lm_bp)
~~~
{: .language-r}



~~~
Error in summary(lm_bp): object 'lm_bp' not found
~~~
{: .error}

#TODO  INTERACTION TERMS, look at literature to see which ones need to be created. 

Next: Just creating one big model just to see for now.

~~~
lm_model <- lm(LBXTC ~ LBXGLU + BMI_category + LBDHDD + LBDLDL + RIDAGEYR + bp_category, data = merge25_df)
~~~
{: .language-r}



~~~
Error in is.data.frame(data): object 'merge25_df' not found
~~~
{: .error}



~~~
summary(lm_model)
~~~
{: .language-r}



~~~
Error in summary(lm_model): object 'lm_model' not found
~~~
{: .error}


